window.trustedTypes&&window.trustedTypes.createPolicy&&window.trustedTypes.createPolicy("default",{createHTML:t=>t,createScript:t=>t}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("avatar-img");t&&t.addEventListener("error",function(){this.src="https://ui-avatars.com/api/?name=Wu+Zi&background=random"});const e=document.getElementById("lang-menu-btn"),n=document.getElementById("lang-menu");if(e&&n){const t={en:"",zh:"zh/",ja:"ja/"},o=Object.fromEntries(Object.entries(t).map(([t,e])=>[e,t])),a=new Set(Object.keys(t)),r=t=>{const o=n.classList.contains("hidden");void 0===t&&(t=o),t?(n.classList.remove("hidden"),e.setAttribute("aria-expanded","true")):(n.classList.add("hidden"),e.setAttribute("aria-expanded","false"))};e.addEventListener("click",t=>{t.stopPropagation(),r()}),document.addEventListener("click",t=>{n.contains(t.target)||e.contains(t.target)||r(!1)}),document.addEventListener("keydown",t=>{"Escape"!==t.key||n.classList.contains("hidden")||(r(!1),e.focus())});const i=(t=window.location.pathname)=>{const e=t.startsWith("http")?t.replace(/^https?:\/\/[^/]+/,""):t,[,n=""]=e.replace(/^\/+/,"/").split("/");return o[n?`${n}/`:""]??"en"},c=e=>{const n=window.SITE_CONFIG?.baseUrl??"/";return`${n.endsWith("/")?n:`${n}/`}${t[e]||""}`},s=t=>{if(!t||"string"!=typeof t)return null;const e=t.toLowerCase(),n=e.split("-")[0];return a.has(e)?e:a.has(n)?n:null},d=()=>{const t=Array.isArray(navigator.languages)&&navigator.languages.length?navigator.languages:[navigator.language];for(const e of t){const t=s(e);if(t)return t}return"en"},l=t=>{if(t?.dataset?.lang)return t.dataset.lang;const e=t?.getAttribute("href")||window.location.pathname;return i(e)},u=n.querySelectorAll("a"),p=new Map(Array.from(u,t=>[t,l(t)])),m={name:new Map,property:new Map},g=(t,e)=>{e.forEach(e=>{const n=document.querySelector(`meta[${t}="${e}"]`);n&&m[t].set(e,n)})};g("name",["title","description"]),g("property",["og:title","og:description","twitter:title","twitter:description","og:url","twitter:url"]);const w={profileName:document.getElementById("profile-name"),profileBio:document.getElementById("profile-bio"),contactBtn:document.getElementById("contact-btn"),contactText:document.getElementById("contact-text"),contactIcon:document.getElementById("contact-icon")},f=w.profileName?.parentElement,y=Array.from(document.querySelectorAll("[data-i18n]")).map(t=>({element:t,key:t.dataset.i18n,type:t.dataset.i18nType||"text"})),h=(t,e,n)=>{const o=m[t].get(e);o&&(o.content=n)},E=(t,e)=>{Object.entries(e).forEach(([e,n])=>h(t,e,n))},I=t=>{t&&(t.classList.remove("animate-fade-in"),t.offsetWidth,t.classList.add("animate-fade-in"))},v=t=>{y.forEach(({element:e,key:n,type:o})=>{const a=t?.[n];void 0!==a&&("html"===o?e.innerHTML=a:e.innerText=a)})};let L=null;const b=e=>{if(!e||e===L)return;const n=window.I18N&&window.I18N[e];if(n){if(document.documentElement.lang=e,document.title=n.title,E("name",{title:n.title,description:n.description}),E("property",{"og:title":n.title,"og:description":n.description,"twitter:title":n.title,"twitter:description":n.description}),window.SITE_CONFIG){const n=`${window.SITE_CONFIG.siteUrl}${t[e]||""}`;E("property",{"og:url":n,"twitter:url":n})}v(n),w.contactBtn&&window.SITE_CONFIG&&(w.contactBtn.href=`${window.SITE_CONFIG.baseUrl}${e}.vcf`),f&&I(f),I(w.contactText),I(w.contactIcon),u.forEach(t=>{const n=p.get(t)===e?"add":"remove";t.classList[n]("bg-gray-50","dark:bg-zinc-700/50","font-bold")}),L=e}};if(window.I18N){(()=>{if("en"!==i())return;const t="preferredLangRedirected";if("true"===sessionStorage.getItem(t))return;const e=d();e&&"en"!==e&&(sessionStorage.setItem(t,"true"),window.location.replace(c(e)))})(),u.forEach(t=>{const e=p.get(t);t.addEventListener("click",n=>{n.preventDefault();const o=t.getAttribute("href");b(e),window.history.pushState({lang:e},"",o),r(!1)})}),window.addEventListener("popstate",()=>{const t=i(window.location.pathname);b(t)});const t=i();b(t)}}});